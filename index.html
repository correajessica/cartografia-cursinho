<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cursinho Popular em Mapa: Cartografia Social e Pr√°ticas do Bem Viver</title>
<!--
Cartografia Social e Pr√°ticas do Bem Viver ‚Äì TC4
Author: Jessica Corr√™a Pantoja, PhD Candidate ‚Äì IAMSPE (S√£o Paulo, Brazil)
Institution: Fiocruz Bras√≠lia ‚Äì Specialization in Popular Education in Health
Year: 2025
Contact: jessicacorreapantoja@gmail.com üê±
License: CC BY-NC-SA 4.0
Publication: https://<seu_usuario>.github.io/cartografia-cursinho
-->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
  :root{--grid:#e5e7eb;--ink:#111827;--muted:#6b7280;--brand:#2563eb;}
  html, body { margin: 0; height: 100%; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color: var(--ink);}  
  #map { height: 100vh; width: 100%; }
  .controls{position:fixed; top:10px; left:10px; z-index:1000; background:#fff; border:1px solid var(--grid); border-radius:12px; padding:12px; box-shadow:0 4px 20px rgba(0,0,0,.08); width:360px;}
  .controls h3{margin:0 0 6px 0; font-size:15px}
  .legend{display:grid; gap:6px; font-size:13px; margin:8px 0}
  .tag{display:flex; align-items:center; gap:8px}
  .dot{width:12px; height:12px; border-radius:999px; display:inline-block; border:2px solid #fff; box-shadow:0 0 0 1px rgba(0,0,0,.1)}
  .muted{font-size:12px; color:var(--muted)}
  .footer{font-size:11px; color:var(--muted); margin-top:8px}
  .row{display:grid; grid-template-columns:1fr 1fr; gap:8px}
  button, label.btn{appearance:none; border:1px solid var(--grid); background:#fff; border-radius:10px; padding:8px 10px; font:inherit; cursor:pointer}
  button.primary{background:var(--brand); color:#fff; border-color:var(--brand)}
  input[type=file]{display:none}
  .filters{display:grid; grid-template-columns:1fr 1fr; gap:6px; font-size:13px}
  .counts{font-size:12px; color:var(--muted); margin:6px 0}
</style>
</head>
<body>
  <div id="map"></div>

  <div class="controls">
    <h3>üè´ Cursinho Popular em Mapa: Cartografia Social e Pr√°ticas do Bem Viver</h3>

    <div class="legend">
      <div class="tag"><span class="dot" style="background:#7c3aed"></span> üó£Ô∏è Comunica√ß√£o popular</div>
      <div class="tag"><span class="dot" style="background:#ef4444"></span> ü§ù Cuidado / Bem Viver</div>
      <div class="tag"><span class="dot" style="background:#0ea5e9"></span> üìö Educa√ß√£o / Monitorias</div>
      <div class="tag"><span class="dot" style="background:#f59e0b"></span> ‚ö†Ô∏è Fragilidade / Desafio</div>
    </div>

    <div class="muted">Clique no mapa para explorar os pontos. Use os filtros abaixo para exibir/ocultar camadas.</div>

    <div style="font-weight:600; font-size:13px; margin-top:8px">Filtros</div>
    <div class="filters">
      <label><input type="checkbox" id="f-com" checked> Comunica√ß√£o <span id="c-com" class="muted"></span></label>
      <label><input type="checkbox" id="f-car" checked> Cuidado <span id="c-car" class="muted"></span></label>
      <label><input type="checkbox" id="f-edu" checked> Educa√ß√£o <span id="c-edu" class="muted"></span></label>
      <label><input type="checkbox" id="f-fra" checked> Fragilidade <span id="c-fra" class="muted"></span></label>
    </div>
    <div class="counts" id="totalCount"></div>

    <div style="font-weight:600; font-size:13px; margin-top:8px">Exportar / Importar</div>
    <div class="row">
      <button id="btnGeo" class="primary">Exportar GeoJSON</button>
      <button id="btnCsv">Exportar CSV</button>
    </div>
    <div class="row" style="margin-top:6px">
      <label class="btn" for="file">Importar GeoJSON</label>
      <input id="file" type="file" accept="application/geo+json,application/json,.geojson" />
      <button id="btnLimpar">Limpar</button>
    </div>

    <div class="footer">
      Author: Jessica Corr√™a Pantoja, PhD Candidate ‚Äì IAMSPE (S√£o Paulo, Brazil) ¬∑ Contact: jessicacorreapantoja@gmail.com üê±
    </div>
  </div>

<script>
  const MAP_CENTER = [-22.939798, -47.0847334];
  const map = L.map('map').setView(MAP_CENTER, 16);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {maxZoom: 19, attribution: '&copy; OpenStreetMap contributors'}).addTo(map);

  // √çcone tipo "school pin" (padr√£o azul do Leaflet)
  const schoolIcon = L.icon({
    iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',
    iconRetinaUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png',
    shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
    iconSize: [25, 41],
    iconAnchor: [12, 41],
    popupAnchor: [1, -34],
    shadowSize: [41, 41]
  });

  const COLORS = { comunicacao:'#7c3aed', cuidado:'#ef4444', educacao:'#0ea5e9', fragilidade:'#f59e0b' };

  const layerCom = L.layerGroup().addTo(map);
  const layerCar = L.layerGroup().addTo(map);
  const layerEdu = L.layerGroup().addTo(map);
  const layerFra = L.layerGroup().addTo(map);
  const LAYERS = { comunicacao: layerCom, cuidado: layerCar, educacao: layerEdu, fragilidade: layerFra };

  // Pontos (PT-BR) com emojis
  const features = [
    { type:'Feature', geometry:{type:'Point', coordinates:[-47.0847334,-22.939798]}, properties:{categoria:'educacao', titulo:'üè´ Sede: E. E. Parque Oziel', descricao:'Local das atividades do Cursinho Popular.', quem:'Comunidade escolar', freq:'Cont√≠nua'} },
    { type:'Feature', geometry:{type:'Point', coordinates:[-47.0849,-22.9396]}, properties:{categoria:'comunicacao', titulo:'üó£Ô∏è Mural comunit√°rio', descricao:'Avisos, editais e divulga√ß√£o de eventos.', quem:'Volunt√°rios', freq:'Mensal'} },
    { type:'Feature', geometry:{type:'Point', coordinates:[-47.0845,-22.9404]}, properties:{categoria:'cuidado', titulo:'ü§ù Roda de escuta e acolhimento', descricao:'Conviv√™ncia, sa√∫de mental e cuidado coletivo.', quem:'Coordena√ß√£o e estudantes', freq:'Quinzenal'} },
    { type:'Feature', geometry:{type:'Point', coordinates:[-47.0839,-22.9392]}, properties:{categoria:'educacao', titulo:'üìñ Monitoria de Reda√ß√£o', descricao:'Apoio √† escrita e leitura cr√≠tica.', quem:'Turma A', freq:'Semanal'} },
    { type:'Feature', geometry:{type:'Point', coordinates:[-47.0852,-22.9390]}, properties:{categoria:'educacao', titulo:'üìö Grupo de estudos em pedagogia popular', descricao:'Leituras e metodologias participativas.', quem:'Docentes e volunt√°rios', freq:'Semanal'} },
    { type:'Feature', geometry:{type:'Point', coordinates:[-47.0835,-22.9400]}, properties:{categoria:'educacao', titulo:'üé® Oficina tem√°tica interdisciplinar', descricao:'Integra√ß√£o de √°reas e resolu√ß√£o de problemas.', quem:'Equipe ampliada', freq:'Mensal'} },
    { type:'Feature', geometry:{type:'Point', coordinates:[-47.0860,-22.9408]}, properties:{categoria:'fragilidade', titulo:'‚ö†Ô∏è Dificuldade de locomo√ß√£o dos estudantes', descricao:'Barreiras de deslocamento e acesso a transporte.', quem:'Estudantes', freq:'Cont√≠nua'} },
    { type:'Feature', geometry:{type:'Point', coordinates:[-47.0856,-22.9388]}, properties:{categoria:'fragilidade', titulo:'üíª Conectividade/Internet limitada', descricao:'Acesso inst√°vel √† internet e a recursos digitais.', quem:'Comunidade escolar', freq:'Cont√≠nua'} },
    { type:'Feature', geometry:{type:'Point', coordinates:[-47.0840,-22.9406]}, properties:{categoria:'comunicacao', titulo:'üéôÔ∏è Rodas de comunica√ß√£o popular', descricao:'Planejamento coletivo, rodas tem√°ticas e devolutivas.', quem:'Coletivo do cursinho', freq:'Mensal'} },
    { type:'Feature', geometry:{type:'Point', coordinates:[-47.0831,-22.9385]}, properties:{categoria:'cuidado', titulo:'ü©∫ Oficina de cuidado com o CS Parque Oziel', descricao:'A√ß√µes de educa√ß√£o em sa√∫de no territ√≥rio.', quem:'Parceria com APS', freq:'Mensal'} }
  ];

  // Renderiza√ß√£o: sede com pin de escola, demais como c√≠rculos coloridos
  for(const f of features){
    const lat = f.geometry.coordinates[1], lng = f.geometry.coordinates[0];
    const p = f.properties;
    const html = `<b>${p.titulo}</b><br>${p.descricao}<br><small>${p.quem} ¬∑ ${p.freq}</small>`;

    if(p.titulo.includes('Sede:')){
      const m = L.marker([lat, lng], { icon: schoolIcon }).bindPopup(html);
      LAYERS[p.categoria].addLayer(m);
    } else {
      const color = COLORS[p.categoria] || '#2563eb';
      const cm = L.circleMarker([lat, lng], { radius: 9, color:'#111827', weight:1, fillColor: color, fillOpacity:.9 }).bindPopup(html);
      LAYERS[p.categoria].addLayer(cm);
    }
  }

  // Filtros + contadores
  const $ = (id)=> document.getElementById(id);
  function setVisible(layer, visible){ visible ? map.addLayer(layer) : map.removeLayer(layer); }
  function updateCounts(){
    const counts = { comunicacao:0, cuidado:0, educacao:0, fragilidade:0 };
    for(const f of features){ counts[f.properties.categoria] = (counts[f.properties.categoria]||0) + 1; }
    $('c-com').textContent = `(${counts.comunicacao||0})`;
    $('c-car').textContent = `(${counts.cuidado||0})`;
    $('c-edu').textContent = `(${counts.educacao||0})`;
    $('c-fra').textContent = `(${counts.fragilidade||0})`;
    $('totalCount').textContent = `Total de pontos: ${features.length}`;
  }
  $('f-com').addEventListener('change', e=> setVisible(layerCom, e.target.checked));
  $('f-car').addEventListener('change', e=> setVisible(layerCar, e.target.checked));
  $('f-edu').addEventListener('change', e=> setVisible(layerEdu, e.target.checked));
  $('f-fra').addEventListener('change', e=> setVisible(layerFra, e.target.checked));
  updateCounts();

  // Exportar / Importar
  function quoteCsv(s){ return '"' + String(s ?? '').replace(/"/g,'""') + '"'; }
  function buildCsv(data, sep, newline){
    const header = ['categoria','titulo','descricao','quem','frequencia','lng','lat'];
    const lines = [header.join(sep)];
    for(const f of data){
      const row = [
        quoteCsv(f.properties.categoria),
        quoteCsv(f.properties.titulo||''),
        quoteCsv(f.properties.descricao||''),
        quoteCsv(f.properties.quem||''),
        quoteCsv(f.properties.freq||''),
        f.geometry.coordinates[0],
        f.geometry.coordinates[1]
      ].join(sep);
      lines.push(row);
    }
    return lines.join(newline);
  }

  document.getElementById('btnGeo').onclick = ()=>{
    const gj = { type:'FeatureCollection', features: features };
    const blob = new Blob([JSON.stringify(gj,null,2)], {type:'application/geo+json'});
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'cartografia_cursinho.geojson'; a.click(); URL.revokeObjectURL(a.href);
  };

  document.getElementById('btnCsv').onclick = ()=>{
    const sep = ';';
    const newline = '\r\n';
    const csv = buildCsv(features, sep, newline);
    const blob = new Blob(['\ufeff', csv], {type:'text/csv;charset=utf-8;'});
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'cartografia_cursinho.csv'; a.click(); URL.revokeObjectURL(a.href);
  };

  document.getElementById('file').addEventListener('change', (ev)=>{
    const file = ev.target.files[0]; if(!file) return;
    const reader = new FileReader();
    reader.onload = ()=>{
      try{
        const gj = JSON.parse(reader.result);
        if(!gj || gj.type!=='FeatureCollection' || !Array.isArray(gj.features)) throw new Error('GeoJSON inv√°lido');
        alert('Importa√ß√£o conclu√≠da: '+gj.features.length+' pontos. (Esta vers√£o √© de apresenta√ß√£o; edi√ß√£o via c√≥digo)');
      }catch(err){ alert('Erro ao importar: '+err.message); }
    };
    reader.readAsText(file);
  });

  document.getElementById('btnLimpar').onclick = ()=> alert('Esta √© a vers√£o de apresenta√ß√£o. Caso deseje o modo edi√ß√£o completo (formul√°rio lateral), posso habilitar.');
</script>
</body>
</html>
